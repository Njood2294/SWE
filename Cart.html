document.addEventListener("DOMContentLoaded", function () {
    const cartContainer = document.querySelector(".cart-items");
    const totalItems = document.getElementById("total-items");
    const totalPrice = document.getElementById("total-price");
    let cartItems = JSON.parse(localStorage.getItem("cartItems")) || [];

    function updateCart() {
        cartContainer.innerHTML = "";
        let totalQuantity = 0;
        let totalCost = 0;

        if (cartItems.length === 0) {
            cartContainer.innerHTML = "<p>Your cart is empty.</p>";
        } else {
            cartItems.forEach((item, index) => {
                let itemDiv = document.createElement("div");
                itemDiv.classList.add("cart-item");

                // Image element with fallback
                let imgElement = document.createElement("img");
                imgElement.alt = item.name;
                imgElement.classList.add("cart-image");
                loadImageWithFallback(imgElement, item.name);

                itemDiv.innerHTML = `
                    <h4>${item.name}</h4>
                    <p>Price: $${item.price}</p>
                    <div class="quantity-controls">
                        <button class="minus-btn" onclick="updateQuantity(${index}, -1)">-</button>
                        <span class="quantity">${item.quantity}</span>
                        <button class="plus-btn" onclick="updateQuantity(${index}, 1)">+</button>
                        <button class="remove-item" onclick="removeItem(${index})">‚ùå</button>
                    </div>
                    <p>Total: $${(item.price * item.quantity).toFixed(2)}</p>
                `;

                itemDiv.insertBefore(imgElement, itemDiv.firstChild);
                cartContainer.appendChild(itemDiv);

                totalQuantity += item.quantity;
                totalCost += item.price * item.quantity;
            });
        }

        totalItems.textContent = totalQuantity;
        totalPrice.textContent = totalCost.toFixed(2);
    }

    function updateQuantity(index, change) {
        cartItems[index].quantity += change;
        if (cartItems[index].quantity < 1) cartItems[index].quantity = 1;
        localStorage.setItem("cartItems", JSON.stringify(cartItems));
        updateCart();
    }

    function removeItem(index) {
        cartItems.splice(index, 1);
        localStorage.setItem("cartItems", JSON.stringify(cartItems));
        updateCart();
    }

    document.querySelector(".checkout-btn").addEventListener("click", function () {
        alert("Proceeding to checkout...");
        // Redirect or handle checkout logic here
    });

    function loadImageWithFallback(imgElement, itemName) {
        const basePath = "images/";
        const formattedName = itemName.toLowerCase();
        const extensions = ["webp", "jpg", "jpeg", "png"];

        for (const ext of extensions) {
            const imagePath = `${basePath}${formattedName}.${ext}`;
            checkImage(imagePath).then((imageExists) => {
                if (imageExists) {
                    imgElement.src = imagePath;
                } else {
                    imgElement.src = `${basePath}placeholder.png`; // Fallback image
                }
            });
        }
    }

    function checkImage(url) {
        return new Promise((resolve) => {
            const img = new Image();
            img.src = url;
            img.onload = () => resolve(true);
            img.onerror = () => resolve(false);
        });
    }

    updateCart();
});

        

